function formatItemDate(e,t){var o="",a=["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],i=t.getHours()>9?t.getHours():"0"+t.getHours(),n=t.getMinutes()>9?t.getMinutes():"0"+t.getMinutes(),o=e.getDate()>9?e.getDate():"0"+e.getDate();return o+" "+a[e.getMonth()+1]+" "+i+":"+n}function formatItemTime(e){var t=e.getHours()>9?e.getHours():"0"+e.getHours(),o=e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes();return t+":"+o}function formatDateMonthExt(e){var t=["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],o=e.getDate()>9?e.getDate():"0"+e.getDate();return o+" "+t[e.getMonth()]}function roundMinutes(e){var t="00";return 0==e?t="00":e>0&&15>=e?t="15":e>15&&30>=e?t="30":e>30&&45>=e?t="45":e>45&&(t="-1"),t}function formatHours(e){var t=e.getHours()>9?e.getHours():"0"+e.getHours(),o=e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes();return"-1"==roundMinutes(o)?(t+=1,o="00"):o=roundMinutes(o),t+":"+o}Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t},angular.module("starter",["ionic","ngCordova","starter.controllers"]).run(["$ionicPlatform","$cordovaStatusbar","$cordovaDevice",function(e,t,o){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&"iOS"==o.getPlatform()&&t.styleHex("#fff")})}]).controller("AppCtrl",["$rootScope","$scope","$http","$location","$ionicPlatform","$ionicLoading","$ionicTabsDelegate","NotificationService",function($rootScope,$scope,$http,$location,$ionicPlatform,$ionicLoading,$ionicTabsDelegate,NotificationService){moment.locale("it"),$ionicPlatform.ready(function(){NotificationService.onDeviceReady();var e=null;navigator.globalization.getLocaleName(function(t){switch(e=0!=t.value.indexOf("-")?t.value.split("-")[0]:t.value){default:$(".head").append('<script src="locale/angular-locale_en.js"></script>');break;case"it":$(".head").append('<script src="locale/angular-locale_it.js"></script>');break;case"en":$(".head").append('<script src="locale/angular-locale_en.js"></script>')}},function(){alert("Error getting language\n")})}),$rootScope.hasTelepass=!1,$rootScope.hasCC=!1;var p=eval("("+window.localStorage.getItem("hasPicture")+")");p&&($rootScope.hasPicture=!0),$scope.gotoBookings=function(){$location.path("/tab/bookings").replace()},$scope.gotoNewbooking=function(){$location.path("/tab/newbooking").replace()},$scope.gotoParking=function(){$rootScope.loadParking&&$rootScope.loadParking(),$location.path("/tab/parking").replace()},$scope.gotoCar=function(){$location.path("/tab/resume").replace()},$scope.gotoSettings=function(){$location.path("/tab/account").replace()}}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.scrolling.jsScrolling(!1),e.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl"}).state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.bookings",{url:"/bookings",views:{"tab-bookings":{templateUrl:"templates/tab-bookings.html",controller:"BookingsCtrl"}}}).state("tab.newbooking",{url:"/newbooking",views:{"tab-newbooking":{templateUrl:"templates/tab-newbooking.html",controller:"NewbookingsCtrl"}}}).state("tab.parking",{url:"/parking",views:{"tab-parking":{templateUrl:"templates/tab-parking.html",controller:"ParkingCtrl"}}}).state("tab.resume",{url:"/resume",views:{"tab-resume":{templateUrl:"templates/tab-book-resume.html",controller:"ResumeCtrl"}}}).state("tab.selcar",{url:"/selcar",views:{"tab-resume":{templateUrl:"templates/car-selection.html",controller:"CarCtrl"}}}).state("tab.account",{url:"/account",views:{"tab-account":{templateUrl:"templates/tab-account.html",controller:"AccountCtrl"}}}),t.otherwise("/login")}]);var CLIENT=null,locale={};angular.module("starter.controllers",[]).controller("LoginCtrl",["$scope","$rootScope","$http","$location","$timeout","$ionicLoading","WebService",function($scope,$rootScope,$http,$location,$timeout,$ionicLoading,WebService){$scope.locale=locale,$scope.loadingLogin=!0,$ionicLoading.show(),$http.get("res/589.xml").success(function(e){e=e.replace("{LANGUAGE}","Italiano"),WebService.ajaxPostRequestDemo(e,589,function(e){$ionicLoading.hide(),$scope.loadingLogin=!1,$scope.clientList=e.clientListBooking,$scope.$apply()})}),$scope["switch"]=function(){$timeout(function(){$rootScope.selectedClient=null,CLIENT=null,window.localStorage.setItem("selclient",null),$scope.$apply()},500)},$scope.selectClient=function(e,t){$timeout(function(){$rootScope.selectedClient=t,CLIENT=$rootScope.selectedClient.value.toLowerCase(),window.localStorage.setItem("selclient",JSON.stringify(t)),$scope.$apply()},500),$("#login-user").val(""),$("#login-password").val("")},$scope.login=function(){$ionicLoading.show();var e=document.querySelector("#login-user").value,t=document.querySelector("#login-password").value;return e?t?($scope.loadingLogin=!0,void WebService.ccsLogin(e,t,function(){$http.get("res/567.xml").success(function(e){$ionicLoading.hide();var t=window.localStorage.getItem("Nr"),o=window.localStorage.getItem("pushId");e=e.replace("{USER_ID}",t),e=e.replace("{PUSH_ID}",o),WebService.ajaxPostRequest(e,567,null),$location.path("/tab/bookings").replace(),$rootScope.loadBookings&&$rootScope.loadBookings(),$timeout(function(){$scope.loadingLogin=!1,$scope.$apply()},500)})},function(){$ionicLoading.hide(),$scope.loadingLogin=!1,$scope.$apply()})):void setTimeout(function(){$("#login-password").focus()},10):void setTimeout(function(){$("#login-user").focus()},10)};var c=eval("("+window.localStorage.getItem("selclient")+")");c&&($rootScope.selectedClient=c,CLIENT=$rootScope.selectedClient.value.toLowerCase());var userId=window.localStorage.getItem("Nr");return null!=userId&&""!=userId?($ionicLoading.hide(),$location.path("/tab/bookings").replace(),void $timeout(function(){$scope.loadingLogin=!1,$scope.$apply()},500)):void 0}]).controller("BookingsCtrl",["$scope","$rootScope","$http","$location","$ionicPopup","$ionicLoading","WebService",function($scope,$rootScope,$http,$location,$ionicPopup,$ionicLoading,WebService){$scope.locale=locale,$scope.BookingsList=new Array;var favo=window.localStorage.getItem("favoriteParking")?eval("("+window.localStorage.getItem("favoriteParking")+")"):null;favo&&($rootScope.selectedParking=favo),$rootScope.loadBookings=function(){$scope.loading=!0,$ionicLoading.show(),$http.get("res/516.xml").success(function(e){var t=window.localStorage.getItem("Nr");e=e.replace("{DRIVER_NUMBER}",t),WebService.ajaxPostRequestTemp(e,516,function(e){$scope.loading=!1,$ionicLoading.hide(),$scope.BookingsList=e.data.BookingsList;for(var t=$scope.BookingsList.length,o=0;t>o;o++){var a=$scope.BookingsList[o].pickup_date,i=$scope.BookingsList[o].pickup_time.split(" ")[1],n=i.split(":")[0]+":"+i.split(":")[1];$scope.BookingsList[o].pickupFormatedDate=a+" "+n;var c=$scope.BookingsList[o].return_date,r=($scope.BookingsList[o].return_time.split(" ")[1],i.split(":")[0]+":"+i.split(":")[1]);switch($scope.BookingsList[o].returnFormatedDate=c+" "+r,$scope.BookingsList[o].cmb_fuel_quantity){default:break;case"0/4":$scope.BookingsList[o].cmb_fuel_quantity="0%";case"1/4":$scope.BookingsList[o].cmb_fuel_quantity="25%";break;case"2/4":$scope.BookingsList[o].cmb_fuel_quantity="50%";break;case"3/4":$scope.BookingsList[o].cmb_fuel_quantity="75%";break;case"4/4":$scope.BookingsList[o].cmb_fuel_quantity="100%"}}console.log($scope.BookingsList)})})},$scope.loading||$rootScope.loadBookings(),$scope.newBooking=function(){$location.path("/tab/newbooking").replace()},$scope["delete"]=function(e){var t=$ionicPopup.confirm({title:"Conferma eliminazione",template:"Sicuro di vole eliminare la prenotazione selezionata?"});t.then(function(t){if(t){if(!e)return;$ionicLoading.show(),$http.get("res/553.xml").success(function(t){t=t.replace("{BOOKING_NUMBER}",e.Nr),WebService.ajaxPostRequest(t,553,function(e){$rootScope.loadBookings()})})}})}}]).controller("NewbookingsCtrl",["$scope","$rootScope","$http","$location","$ionicLoading","$cordovaDatePicker","WebService",function(e,t,o,a,i,n,c){e.locale=locale,e.selectFromDate=function(){t.dateFromPick={date:t.dateFromPick&&t.dateFromPick.inputDate?t.dateFromPick.inputDate:new Date,mode:"date",minDate:new Date-1e4,allowOldDates:!1,allowFutureDates:!0,doneButtonLabel:e.locale.date.butChange,cancelButtonLabel:e.locale.date.labelClose,cancelButtonColor:"#000000",locale:e.locale.locale},n.show(t.dateFromPick).then(function(o){return console.log(o),o?(t.dateFromPick.inputDate=o,void e.checkDatetime()):void(t.dateValidated=!1)})},e.selectFromTime=function(){var o=!1;t.dateFromPick.inputDate&&t.dateFromPick.inputDate.getDate()==(new Date).getDate()&&t.dateFromPick.inputDate.getMonth()==(new Date).getMonth()&&t.dateFromPick.inputDate.getFullYear()==(new Date).getFullYear()&&(o=!0),t.timeFromPick={date:t.timeFromPick&&t.timeFromPick.inputTime?t.timeFromPick.inputTime:new Date,mode:"time",is24Hour:!0,allowOldDates:!0,allowFutureDates:!0,doneButtonLabel:e.locale.date.butChange,cancelButtonLabel:e.locale.date.labelClose,cancelButtonColor:"#000000",locale:e.locale.locale},o&&(t.timeFromPick.minDate=new Date-1e4),n.show(t.timeFromPick).then(function(o){if(console.log(o),!o)return void(t.dateValidated=!1);var a=new Date(o),i=new Date(o);a.getMinutes()>=0&&a.getMinutes()<=7?i.setMinutes(0):a.getMinutes()>=7&&a.getMinutes()<=22?i.setMinutes(15):a.getMinutes()>=22&&a.getMinutes()<=37?i.setMinutes(30):a.getMinutes()>=37&&a.getMinutes()<=59&&i.setMinutes(45),t.timeFromPick.inputTime=i,e.checkDatetime()})},e.selectToDate=function(){var o=new Date;t.dateFromPick&&t.dateFromPick.inputDate?o=new Date(t.dateFromPick.inputDate):t.dateToPick&&(t.dateToPick.inputDate?o=new Date(t.dateToPick.inputDate):t.dateToPick.inputDate&&(o=new Date)),t.dateToPick={date:o,mode:"date",minDate:new Date-1e4,allowOldDates:!1,allowFutureDates:!0,doneButtonLabel:e.locale.date.butChange,cancelButtonLabel:e.locale.date.labelClose,cancelButtonColor:"#000000",locale:e.locale.locale},console.log(t.dateToPick),n.show(t.dateToPick).then(function(o){return console.log(o),o?(t.dateToPick.inputDate=o,void e.checkDatetime()):void(t.dateValidated=!1)})},e.selectToTime=function(){var o=!1;t.dateToPick.inputDate&&t.dateToPick.inputDate.getDate()==(new Date).getDate()&&t.dateToPick.inputDate.getMonth()==(new Date).getMonth()&&t.dateToPick.inputDate.getFullYear()==(new Date).getFullYear()&&(o=!0),t.timeToPick={date:t.timeToPick&&t.timeToPick.inputTime?t.timeToPick.inputTime:new Date,mode:"time",is24Hour:!0,allowOldDates:!0,allowFutureDates:!0,doneButtonLabel:e.locale.date.butChange,cancelButtonLabel:e.locale.date.labelClose,cancelButtonColor:"#000000",locale:e.locale.locale},o&&(t.timeToPick.minDate=new Date-1e4),n.show(t.timeToPick).then(function(o){if(console.log(o),!o)return void(t.dateValidated=!1);var a=new Date(o),i=new Date(o);a.getMinutes()>=0&&a.getMinutes()<=7?i.setMinutes(0):a.getMinutes()>=7&&a.getMinutes()<=22?i.setMinutes(15):a.getMinutes()>=22&&a.getMinutes()<=37?i.setMinutes(30):a.getMinutes()>=37&&a.getMinutes()<=59&&i.setMinutes(45),t.timeToPick.inputTime=i,e.checkDatetime()})},e.checkDatetime=function(){if(!(t.dateFromPick&&t.dateToPick&&t.timeFromPick&&t.timeToPick))return void(t.dateValidated=!1);var e=t.dateFromPick.inputDate,o=t.dateToPick.inputDate,a=t.timeFromPick.inputTime,i=t.timeToPick.inputTime;if(!(e&&o&&a&&i))return void(t.dateValidated=!1);var n=new Date(a),c=new Date(i),r=new Date(e);r.setHours(n.getHours()),r.setMinutes(n.getMinutes());var l=new Date(o);l.setHours(c.getHours()),l.setMinutes(c.getMinutes());var s=moment(r),u=moment(l);if(!(r&&l&&n&&c))return void(t.dateValidated=!1);var p=!1;if(o.getDate()==(new Date).getDate()&&o.getMonth()==(new Date).getMonth()&&o.getFullYear()==(new Date).getFullYear()&&(p=!0),p){if(r.getHours()<(new Date).getHours())return void(t.dateValidated=!1);if(r.getHours()==(new Date).getHours()&&r.getMinutes()<(new Date).getMinutes())return void(t.dateValidated=!1);if(r.getHours()==l.getHours()&&r.getMinutes()==l.getMinutes())return void(t.dateValidated=!1)}u.diff(s)<0?t.dateValidated=!1:t.dateValidated=!0},e.gotoParking=function(){return e.checkDatetime(),t.dateValidated?t.selectedParking?void a.path("/tab/resume").replace():void a.path("/tab/parking").replace():!1}}]).controller("ParkingCtrl",["$scope","$rootScope","$http","$location","$ionicLoading","WebService",function($scope,$rootScope,$http,$location,$ionicLoading,WebService){$scope.locale=locale,$rootScope.loadParking=function(){$ionicLoading.show(),$http.get("res/512.xml").success(function(res){var driver=window.localStorage.getItem("Nr");res=res.replace("{DRIVER_NUMBER}",driver),WebService.ajaxPostRequest(res,512,function(data){$ionicLoading.hide(),data.data.ParkingsList?$rootScope.parkingList=data.data.ParkingsList:$rootScope.parkingList=new Array;var favo=window.localStorage.getItem("favoriteParking")?eval("("+window.localStorage.getItem("favoriteParking")+")"):null;if(favo)for(var i=0;i<$rootScope.parkingList.length;i++)$rootScope.parkingList[i].Nr==favo.Nr&&($rootScope.parkingList[i].selected=!0,$rootScope.selectedParking=$rootScope.parkingList[i]);$scope.$apply()})})},$scope.stopPropagation=function(e){e.stopImmediatePropagation(),e.stopPropagation()},$scope.toggleFavorite=function(e){for(var t=e.selected,o=0;o<$rootScope.parkingList.length;o++)$rootScope.parkingList[o].selected=!1;t?(e.selected=!1,window.localStorage.removeItem("favoriteParking")):(e.selected=!0,window.localStorage.setItem("favoriteParking",JSON.stringify(e)))},$scope.selectParking=function(e){$rootScope.selectedParking=e,$location.path("/tab/resume").replace()},$rootScope.loadParking()}]).controller("ResumeCtrl",["$scope","$rootScope","$location","$ionicLoading","$timeout",function(e,t,o,a,i){e.locale=locale,t.cannotReserve=!1,e.setHasCC=function(){t.hasCC=!t.hasCC},e.setHasTelepass=function(){t.hasTelepass=!t.hasTelepass},e.changeDate=function(){o.path("/tab/newbooking").replace()},e.changeParking=function(){o.path("/tab/parking").replace()},e.searchVehicle=function(){o.path("/tab/selcar").replace(),i(function(){t.loadVehicles()},300)}}]).controller("CarCtrl",["$scope","$http","$rootScope","$location","$timeout","$ionicModal","$ionicLoading","$ionicPopup","WebService",function(e,t,o,a,i,n,c,r,l){e.locale=locale,l.ajaxPostRequestDirect(588,function(t){e.justifyList=t.ListJustification,e.justifyList[0].selected=!0,e.selectedJustify=e.justifyList[0],e.$apply()}),n.fromTemplateUrl("templates/pop-confirm.html",{scope:e,animation:"slide-in-up"}).then(function(e){o.popConfirm=e}),e.closeModal=function(){o.popConfirm.hide()},e.onSelect=function(e){o.selectedCar=e,o.popConfirm.show()},e.selectJustify=function(t,o){for(var a=0;a<e.justifyList.length;a++)e.justifyList[a].selected=!1;e.justifyList[t].selected=!0,e.selectedJustify=o},e.confirm=function(){var i=$(".place_val").val(),n=e.selectedJustify.code,s=o.hasCC,u=o.hasTelepass;return o.selectedClient.cc||(s=!1),o.selectedClient.telepass||(u=!1),i?(c.show(),void t.get("res/514.xml").success(function(t){var p=window.localStorage.getItem("Nr");t=t.replace("{NUMBER_VEHICLE}",o.selectedCar.Nr).replace("{NUMBER_DRIVER}",p).replace("{DATE_FROM}",moment(o.dateFromPick.inputDate).format("L")).replace("{DATE_TO}",moment(o.dateToPick.inputDate).format("L")).replace("{TIME_FROM}",moment(o.timeFromPick.inputTime).format("HH:mm")).replace("{TIME_TO}",moment(o.timeToPick.inputTime).format("HH:mm")).replace("{PLACE}",i).replace("{JUSTIFICATION}",n).replace("{CC}",s).replace("{TELEPASS}",u),console.log(t),l.ajaxPostRequest(t,514,function(t){c.hide(),e.PNRstring=t.data.PNRstring[0].PNR,e.isConfirmed=!0;var i=r.alert({title:e.locale.confirmation.labelRequestComplete,template:e.locale.home.rsvinfo.labPRN+": <b>"+e.PNRstring+"</b>"});e.closeModal(),i.then(function(e){o.loadBookings(),a.path("/tab/bookings")}),e.$apply()})})):void r.alert({title:e.locale.confirmation.labelIncomplete,template:e.locale.confirmation.labelSelectPlace})},e.vehicleList=new Array,o.loadVehicles=function(){e.loading=!0;var i=o.hasCC,n=o.hasTelepass;o.selectedClient.cc||(i=!1),o.selectedClient.telepass||(n=!1),o.cannotReserve=!1,c.show(),t.get("res/571.xml").success(function(t){t=t.replace("{NUMBER_PARKING}",o.selectedParking.Nr).replace("{NUMBER_DRIVER}",window.localStorage.getItem("Nr")).replace("{DATE_FROM}",moment(o.dateFromPick.inputDate).format("L")).replace("{DATE_TO}",moment(o.dateToPick.inputDate).format("L")).replace("{TIME_FROM}",moment(o.timeFromPick.inputTime).format("HH:mm")).replace("{TIME_TO}",moment(o.timeToPick.inputTime).format("HH:mm")).replace("{CC}",i).replace("{TELEPASS}",n),l.ajaxPostRequest(t,571,function(t){e.loading=!1,c.hide(),1==t.retcode&&(o.cannotReserve=!0,a.path("/tab/resume").replace()),e.vehicleList=t.data.VehiclesList;for(var i=0;i<e.vehicleList.length;i++)switch(e.vehicleList[i].fuel_quantity){default:break;case"0/4":e.vehicleList[i].fuel_quantity="0%";case"1/4":e.vehicleList[i].fuel_quantity="25%";break;case"2/4":e.vehicleList[i].fuel_quantity="50%";break;case"3/4":e.vehicleList[i].fuel_quantity="75%";break;case"4/4":e.vehicleList[i].fuel_quantity="100%"}e.$apply(),e.isLoading=!1,0==e.vehicleList.length&&1!=t.retcode})})}}]).controller("AccountCtrl",["$rootScope","$scope","$http","$location","$ionicLoading","WebService",function(e,t,o,a,i,n){t.locale=locale,t.setHasPicture=function(){e.hasPicture=!e.hasPicture,window.localStorage.setItem("hasPicture",e.hasPicture)},t.logout=function(){var c=window.localStorage.getItem("Nr");window.localStorage.removeItem("Nr"),$("#login-password").val(""),i.show(),o.get("res/569.xml").success(function(o){i.hide(),o=o.replace("{USER_ID}",c),n.ajaxPostRequest(o,569,null),e.selectedParking=null,e.parkingList=new Array,e.selectedCar=null,window.localStorage.removeItem("favoriteParking"),t.$apply(),a.path("/login")})}}]).service("WebService",["$http","$q",function(e,t){function o(t,o,a,i){e.get("res/515.xml").success(function(n){n=n.replace("{USER_NAME}",t).replace("{PASSWORD}",o),e({url:"http://"+CLIENT+".corporatecarsharing.biz/api.svc/ScriptParameterSets",method:"POST",data:n,headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4","Content-Type":"application/atom+xml"}}).success(function(o,n,c,r){var l=e.get("http://"+CLIENT+".corporatecarsharing.biz/api.svc/ExecuteAdminScript?scriptId=515&scriptParameterSetId="+o.d.Id,{headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4"}});l.success(function(e,o,n,c){console.log(e.d.ExecuteAdminScript);var r=JSON.parse(e.d.ExecuteAdminScript.ResultValue),l=r.data.DriverList;l.length>0?(window.localStorage.setItem("Nr",l[0].Nr),window.localStorage.setItem("user_name",t),a&&a()):i()})}).error(function(e){console.log(e),i()})})}function a(t,o){var a=e.get("http://"+CLIENT+".corporatecarsharing.biz/api.svc/ExecuteAdminScript?scriptId="+t+"&scriptParameterSetId=0",{headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4"}});a.success(function(e,a,i,n){var c;553!=t?(c=JSON.parse(e.d.ExecuteAdminScript.ResultValue),o&&o(c)):o()})}function i(t,o,a){e({url:"http://demo.corporatecarsharing.biz/api.svc/ScriptParameterSets",method:"POST",data:t,headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4","Content-Type":"application/atom+xml"}}).success(function(t,i,n,c){var r=e.get("http://demo.corporatecarsharing.biz/api.svc/ExecuteAdminScript?scriptId="+o+"&scriptParameterSetId="+t.d.Id,{headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4"}});r.success(function(e,t,i,n){var c;553!=o?(c=JSON.parse(e.d.ExecuteAdminScript.ResultValue),a&&a(c)):a()})})}function n(t,o,a){e({url:"http://"+CLIENT+".corporatecarsharing.biz/api.svc/ScriptParameterSets",method:"POST",data:t,headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4","Content-Type":"application/atom+xml"}}).success(function(t,i,n,c){var r=e.get("http://"+CLIENT+".corporatecarsharing.biz/api.svc/ExecuteAdminScript?scriptId="+o+"&scriptParameterSetId="+t.d.Id,{headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4"}});r.success(function(e,t,i,n){var c;console.log(e),553!=o?(c=JSON.parse(e.d.ExecuteAdminScript.ResultValue),a&&a(c)):a()})})}function c(t,o,a){e({url:"http://"+CLIENT+".corporatecarsharing.biz/api.svc/ScriptParameterSets",method:"POST",data:t,headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4","Content-Type":"application/atom+xml"}}).success(function(t,i,n,c){var r=e.get("http://"+CLIENT+".corporatecarsharing.biz/api.svc/ExecuteAdminScript?scriptId="+o+"&scriptParameterSetId="+t.d.Id,{headers:{"TenForce-Auth":"dGVuZm9yY2UuaXRAVEYuY29tfGRlbW9pdGFseTEyMTY4"}});r.success(function(e,t,o,i){var n=JSON.parse(e.d.ExecuteAdminScript.ResultValue.replace("}, ] }","} ] }"));n&&a&&a(n)})})}return{ccsLogin:o,ajaxPostRequest:n,ajaxPostRequestDemo:i,ajaxPostRequestTemp:c,ajaxPostRequestDirect:a}}]).service("NotificationService",["$http","$q","WebService",function(e,t,o){var a,i={};i.onDeviceReady=function(){try{a=window.plugins.pushNotification,"android"==device.platform||"Android"==device.platform||"amazon-fireos"==device.platform?a.register(c,r,{senderID:"8400650074",ecb:"onNotification"}):a.register(n,r,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})}catch(e){console.log(e);var t="There was an error on this page.\n\n";t+="Error description: "+e.message+"\n\n"}},window.onNotification=function(t){switch(t.event){case"registered":t.regid.length>0&&(window.localStorage.setItem("pushId",t.regid),e.get("res/567.xml").success(function(e){var a=window.localStorage.getItem("Nr");e=e.replace("{USER_ID}",a),e=e.replace("{PUSH_ID}",t.regid),o.ajaxPostRequest(e,567,null)}));break;case"message":t.foreground&&navigator.notification.alert(t.payload.message,function(){},"CCS Notifications ","OK"),console.log("MESSAGE  "+t.payload.message),console.log("MESSAGE -> MSGCNT:   "+t.payload.msgcnt),console.log("MESSAGE -> TIMESTAMP:   "+t.payload.timeStamp);break;case"error":console.log("ERROR -> MSG:"+t.msg);break;default:console.log("EVENT -> Unknown, an event was received and we do not know what it is")}},window.onNotificationAPN=function(e){alert("aa"),e.alert&&alert(e.alert),e.sound,e.badge&&a.setApplicationIconBadgeNumber(c,e.badge)};var n=function(t){window.localStorage.setItem("pushId",t),e.get("res/567.xml").success(function(e){var a=window.localStorage.getItem("Nr");e=e.replace("{USER_ID}",a),e=e.replace("{PUSH_ID}",t),o.ajaxPostRequest(e,567,null)})},c=function(e){},r=function(e){console.log("error:"+e)};return i}]);